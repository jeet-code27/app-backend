<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Services Management Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1F2937'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <h1 class="text-2xl font-bold text-gray-900">üõçÔ∏è Services Management Dashboard</h1>
                <div class="flex space-x-4">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800" id="serverStatus">
                        üî¥ Server Offline
                    </span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
            <!-- Add Service Form -->
            <div class="xl:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6 sticky top-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        ‚ûï Add New Service
                    </h2>

                    <form id="serviceForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Title *</label>
                            <input type="text" id="serviceTitle" placeholder="e.g., Personal Website Development" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                            <select id="serviceCategory" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select Category</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                            <textarea id="serviceDescription" placeholder="Detailed service description" required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="3"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Short Description</label>
                            <input type="text" id="serviceShortDescription" placeholder="Brief summary for cards"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Starting Price *</label>
                                <input type="number" id="servicePrice" placeholder="15000" required min="0"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                                <select id="serviceCurrency"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="INR">‚Çπ INR</option>
                                    <option value="USD">$ USD</option>
                                    <option value="EUR">‚Ç¨ EUR</option>
                                    <option value="GBP">¬£ GBP</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Delivery Time *</label>
                                <input type="number" id="serviceDeliveryTime" placeholder="7" required min="1"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
                                <select id="serviceDeliveryUnit"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="days">Days</option>
                                    <option value="weeks">Weeks</option>
                                    <option value="months">Months</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Features</label>
                            <input type="text" id="serviceFeatures" placeholder="Responsive Design, SEO Optimized, Fast Loading"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Separate features with commas</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Service Image</label>
                            <input type="file" id="serviceImage" accept="image/*"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Max 5MB, JPG/PNG/GIF</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                            <input type="text" id="serviceTags" placeholder="website, development, responsive"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Separate tags with commas</p>
                        </div>

                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-gray-700">Service Flags</label>
                            <div class="flex flex-wrap items-center gap-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="serviceActive" checked class="mr-2 text-blue-600">
                                    <span class="text-sm">Active</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="serviceFeatured" class="mr-2 text-purple-600">
                                    <span class="text-sm">Featured</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="servicePopular" class="mr-2 text-orange-600">
                                    <span class="text-sm">Popular</span>
                                </label>
                            </div>
                        </div>

                        <!-- SEO Section -->
                        <div class="border-t pt-4">
                            <h3 class="text-sm font-medium text-gray-700 mb-3">SEO Settings (Optional)</h3>
                            <div class="space-y-3">
                                <input type="text" id="serviceMetaTitle" placeholder="Meta Title (60 chars max)"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <textarea id="serviceMetaDescription" placeholder="Meta Description (160 chars max)" rows="2"
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                <input type="text" id="serviceMetaKeywords" placeholder="Meta Keywords (comma separated)"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors font-medium">
                            üöÄ Create Service
                        </button>
                    </form>
                </div>
            </div>

            <!-- Services List -->
            <div class="xl:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                            üìã Services List
                        </h2>
                        <div class="flex items-center space-x-3">
                            <select id="filterCategory" class="px-3 py-1 border border-gray-300 rounded-md text-sm">
                                <option value="">All Categories</option>
                            </select>
                            <button onclick="loadServices()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                üîÑ Refresh
                            </button>
                        </div>
                    </div>

                    <div id="servicesList" class="space-y-4">
                        <!-- Services will be loaded here -->
                        <div class="text-center py-8 text-gray-500">
                            Loading services...
                        </div>
                    </div>
                </div>

                <!-- API Testing Section -->
                <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        üß™ Quick API Tests
                    </h3>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                        <button onclick="testAPI('/api/services')" class="bg-blue-100 hover:bg-blue-200 text-blue-800 p-2 rounded text-sm font-medium transition-colors">
                            All Services
                        </button>
                        <button onclick="testAPI('/api/services/featured')" class="bg-purple-100 hover:bg-purple-200 text-purple-800 p-2 rounded text-sm font-medium transition-colors">
                            Featured Services
                        </button>
                        <button onclick="testAPI('/api/services/popular')" class="bg-orange-100 hover:bg-orange-200 text-orange-800 p-2 rounded text-sm font-medium transition-colors">
                            Popular Services
                        </button>
                        <button onclick="testAPI('/api/categories/active')" class="bg-green-100 hover:bg-green-200 text-green-800 p-2 rounded text-sm font-medium transition-colors">
                            Active Categories
                        </button>
                    </div>

                    <!-- API Response Display -->
                    <div id="apiResponse" class="bg-gray-100 p-4 rounded-lg min-h-32 max-h-64 overflow-y-auto text-sm">
                        <p class="text-gray-500">Click any API test button to see the response here...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed top-4 right-4 z-50"></div>

    <script>
        const API_BASE = 'http://localhost:5000';

        // Check server status on load
        window.addEventListener('load', function() {
            checkServerStatus();
            loadCategoryOptions();
            loadServices();
        });

        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                if (response.ok) {
                    document.getElementById('serverStatus').innerHTML = 'üü¢ Server Online';
                    document.getElementById('serverStatus').className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800';
                }
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = 'üî¥ Server Offline';
                document.getElementById('serverStatus').className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800';
            }
        }

        // Show messages
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `alert ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white px-4 py-2 rounded-lg shadow-lg mb-2`;
            messageDiv.textContent = message;
            
            document.getElementById('messageContainer').appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Load category options for service form and filter
        async function loadCategoryOptions() {
            try {
                const response = await fetch(`${API_BASE}/api/categories/active`);
                const data = await response.json();
                
                if (data.success) {
                    const categorySelect = document.getElementById('serviceCategory');
                    const filterSelect = document.getElementById('filterCategory');
                    
                    categorySelect.innerHTML = '<option value="">Select Category</option>';
                    filterSelect.innerHTML = '<option value="">All Categories</option>';
                    
                    data.data.forEach(category => {
                        const option1 = document.createElement('option');
                        option1.value = category._id;
                        option1.textContent = category.title;
                        categorySelect.appendChild(option1);

                        const option2 = document.createElement('option');
                        option2.value = category._id;
                        option2.textContent = category.title;
                        filterSelect.appendChild(option2);
                    });
                }
            } catch (error) {
                console.error('Error loading category options:', error);
            }
        }

        // Load services
        async function loadServices() {
            try {
                const filterCategory = document.getElementById('filterCategory').value;
                let url = `${API_BASE}/api/services`;
                if (filterCategory) {
                    url += `?category=${filterCategory}`;
                }

                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    const servicesList = document.getElementById('servicesList');
                    servicesList.innerHTML = '';
                    
                    if (data.data.length === 0) {
                        servicesList.innerHTML = '<div class="text-center py-8 text-gray-500">No services found</div>';
                        return;
                    }
                    
                    data.data.forEach(service => {
                        const serviceDiv = document.createElement('div');
                        serviceDiv.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
                        
                        const currencySymbols = { INR: '‚Çπ', USD: '$', EUR: '‚Ç¨', GBP: '¬£' };
                        const currencySymbol = currencySymbols[service.pricing.currency] || '‚Çπ';
                        
                        serviceDiv.innerHTML = `
                            <div class="flex gap-4">
                                ${service.image ? `
                                    <div class="flex-shrink-0">
                                        <img src="${service.image.url}" alt="${service.title}" 
                                             class="w-20 h-20 object-cover rounded-lg border">
                                    </div>
                                ` : `
                                    <div class="flex-shrink-0 w-20 h-20 bg-gray-100 rounded-lg border flex items-center justify-center">
                                        <span class="text-gray-400 text-xs">No Image</span>
                                    </div>
                                `}
                                
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-gray-900 text-lg">${service.title}</h4>
                                            <p class="text-sm text-blue-600 font-medium mb-2">${service.category.title}</p>
                                            <p class="text-gray-600 text-sm mb-3">${service.shortDescription || service.description.substring(0, 120) + '...'}</p>
                                            
                                            ${service.features && service.features.length > 0 ? `
                                                <div class="flex flex-wrap gap-1 mb-3">
                                                    ${service.features.slice(0, 3).map(feature => 
                                                        `<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">${feature}</span>`
                                                    ).join('')}
                                                    ${service.features.length > 3 ? `<span class="text-xs text-gray-500">+${service.features.length - 3} more</span>` : ''}
                                                </div>
                                            ` : ''}
                                            
                                            <div class="flex items-center space-x-4 text-sm">
                                                <span class="font-bold text-green-600 text-lg">${currencySymbol}${service.pricing.startingPrice.toLocaleString()}</span>
                                                <span class="text-gray-500">‚Ä¢ ${service.deliveryTime.value} ${service.deliveryTime.unit}</span>
                                                <span class="text-gray-500">‚Ä¢ ${service.metadata.views || 0} views</span>
                                            </div>
                                            
                                            <div class="flex items-center space-x-2 mt-3">
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${service.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                    ${service.isActive ? '‚úÖ Active' : '‚ùå Inactive'}
                                                </span>
                                                ${service.isFeatured ? '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">‚≠ê Featured</span>' : ''}
                                                ${service.isPopular ? '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">üî• Popular</span>' : ''}
                                            </div>
                                        </div>
                                        <div class="flex flex-col space-y-2 ml-4">
                                            <button onclick="toggleServiceStatus('${service._id}')" 
                                                    class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                                ${service.isActive ? 'Deactivate' : 'Activate'}
                                            </button>
                                            <button onclick="deleteService('${service._id}')" 
                                                    class="text-red-600 hover:text-red-800 text-sm font-medium">
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        servicesList.appendChild(serviceDiv);
                    });
                }
            } catch (error) {
                showMessage('Error loading services: ' + error.message, 'error');
                document.getElementById('servicesList').innerHTML = '<div class="text-center py-8 text-red-500">Error loading services</div>';
            }
        }

        // Filter services by category
        document.getElementById('filterCategory').addEventListener('change', loadServices);

        // Add service with image upload
        document.getElementById('serviceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            
            // Add text fields
            formData.append('title', document.getElementById('serviceTitle').value);
            formData.append('description', document.getElementById('serviceDescription').value);
            formData.append('shortDescription', document.getElementById('serviceShortDescription').value);
            formData.append('category', document.getElementById('serviceCategory').value);
            formData.append('startingPrice', document.getElementById('servicePrice').value);
            formData.append('currency', document.getElementById('serviceCurrency').value);
            formData.append('deliveryTimeValue', document.getElementById('serviceDeliveryTime').value);
            formData.append('deliveryTimeUnit', document.getElementById('serviceDeliveryUnit').value);
            formData.append('features', document.getElementById('serviceFeatures').value);
            formData.append('tags', document.getElementById('serviceTags').value);
            formData.append('isActive', document.getElementById('serviceActive').checked);
            formData.append('isFeatured', document.getElementById('serviceFeatured').checked);
            formData.append('isPopular', document.getElementById('servicePopular').checked);
            formData.append('metaTitle', document.getElementById('serviceMetaTitle').value);
            formData.append('metaDescription', document.getElementById('serviceMetaDescription').value);
            formData.append('metaKeywords', document.getElementById('serviceMetaKeywords').value);
            
            // Add image file
            const imageFile = document.getElementById('serviceImage').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            try {
                const response = await fetch(`${API_BASE}/api/services`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage('Service created successfully! üéâ');
                    document.getElementById('serviceForm').reset();
                    document.getElementById('serviceActive').checked = true;
                    document.getElementById('serviceCurrency').value = 'INR';
                    document.getElementById('serviceDeliveryUnit').value = 'days';
                    loadServices();
                } else {
                    showMessage('Error: ' + (data.message || data.errors?.[0]?.msg || 'Unknown error'), 'error');
                }
            } catch (error) {
                showMessage('Error creating service: ' + error.message, 'error');
            }
        });

        // Toggle service status
        async function toggleServiceStatus(id) {
            try {
                const response = await fetch(`${API_BASE}/api/services/${id}/toggle-active`, {
                    method: 'PATCH'
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message);
                    loadServices();
                } else {
                    showMessage('Error: ' + data.message, 'error');
                }
            } catch (error) {
                showMessage('Error toggling service status: ' + error.message, 'error');
            }
        }

        // Delete service
        async function deleteService(id) {
            if (confirm('Are you sure you want to delete this service? This action cannot be undone.')) {
                try {
                    const response = await fetch(`${API_BASE}/api/services/${id}`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        showMessage('Service deleted successfully! üóëÔ∏è');
                        loadServices();
                    } else {
                        showMessage('Error: ' + data.message, 'error');
                    }
                } catch (error) {
                    showMessage('Error deleting service: ' + error.message, 'error');
                }
            }
        }

        // Test API endpoints
        async function testAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                
                document.getElementById('apiResponse').innerHTML = `
                    <div class="mb-2">
                        <span class="font-medium">Endpoint:</span> <code class="bg-gray-200 px-2 py-1 rounded text-xs">${endpoint}</code>
                    </div>
                    <div class="mb-2">
                        <span class="font-medium">Status:</span> <span class="${response.ok ? 'text-green-600' : 'text-red-600'}">${response.status} ${response.statusText}</span>
                    </div>
                    <div>
                        <span class="font-medium">Response:</span>
                        <pre class="bg-gray-50 p-3 rounded mt-2 text-xs overflow-x-auto max-h-48 overflow-y-auto">${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('apiResponse').innerHTML = `
                    <div class="text-red-600">
                        <span class="font-medium">Error:</span> ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>